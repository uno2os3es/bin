#!/data/data/com.termux/files/usr/bin/env python3

import os
import pathlib
import sys
from pathlib import Path

# File extensions to look for
FONT_EXTENSIONS = ('.ttf', '.otf', '.woff', '.woff2')
# Output HTML file
OUTPUT_HTML = 'fonts_preview.html'
# Font sizes to preview
FONT_SIZES = [14]


def find_fonts(root_dir='.'):
    """Recursively find font files in the given directory."""
    fonts = []
    for dirpath, _, filenames in os.walk(root_dir):
        fonts.extend(
            os.path.join(dirpath, filename) for filename in filenames
            if filename.lower().endswith(FONT_EXTENSIONS))
    return fonts


def generate_html(font_files):
    """Generate HTML to preview fonts."""
    html = [
        '<!DOCTYPE html>',
        "<html lang='en'>",
        '<head>',
        "<meta charset='UTF-8'>",
        '<title>Font Preview</title>',
        '<style>',
        'body { font-family: sans-serif; padding: 20px; }',
        '.font-preview { margin-bottom: 50px; }',
        '</style>',
        '</head>',
        '<body>',
        '<h1>Font Preview</h1>',
    ]
    for font_path in font_files:
        font_name = pathlib.Path(font_path).name
        html.append("<div class='font-preview'>")
        html.append(f'<h2>{font_name}</h2>')
        # Embed font using @font-face
        html.append('<style>')
        html.append(
            f"@font-face {{ font-family: '{font_name}'; src: url('{font_path}'); }}",
        )
        html.append('</style>')
        html.extend(
            f'<p style=\'font-family: "{font_name}"; font-size: {size}px;\'>The quick brown fox jumps over the lazy dog ({size}px)</p>'
            for size in FONT_SIZES)
        html.append('</div>')
    html.append('</body></html>')
    return '\n'.join(html)


def main() -> None:
    fonts = find_fonts()
    if not fonts:
        return
    html_content = generate_html(fonts)
    with pathlib.Path(OUTPUT_HTML).open('w', encoding='utf-8') as f:
        f.write(html_content)


if __name__ == '__main__':
    main()
